(()=>{"use strict";var e,t,n,r,o={795:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{D9:()=>l,LO:()=>p,SJ:()=>d,Uc:()=>f,fG:()=>u});var o=n(497),a=e([o]);o=(a.then?(await a)():a)[0];var c={baseUrl:"https://nomoreparties.co/v1/".concat(o.$I),headers:{authorization:"936197d7-9c28-4a02-b461-a2e30a81b6a7","Content-Type":"application/json"}},i=function(e){return e.ok?(console.log("Успешно",e),e.json()):Promise.reject(e.status)},s=function(e){return console.log("Ошибка в запросе GET: ".concat(e,".")),Promise.reject("Что-то пошло не так: ".concat(e))},u=function(e){return fetch(e,{headers:c.headers}).then(i).catch(s)},l=function(e,t){return fetch(t,{method:"PATCH",headers:c.headers,body:JSON.stringify(e)}).then(i).catch(s)},d=function(e){return fetch(e,{method:"DELETE",headers:c.headers}).then(i).catch(s)},p=function(e,t){return fetch(t,{method:"POST",headers:c.headers,body:JSON.stringify(e)}).then(i).catch(s)},f=function(e,t){return fetch(t,{method:"PUT",headers:c.headers,body:JSON.stringify(e)}).then(i).catch(s)};r()}catch(e){r(e)}}))},694:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{G1:()=>f,GO:()=>d,dW:()=>p,zY:()=>v});var o=n(497),a=n(795),c=n(734),i=n(756),s=e([o,a,i]);[o,a,i]=s.then?(await s)():s;var u=function(e){var t="https://nomoreparties.co/v1/".concat(o.$I,"/cards/likes/").concat(e);return(0,a.Uc)(o.m0,t).then((function(e){return console.log("Отправил лайк на сервер успешно",e),(0,c.m)(c.$.likeMessage),e})).catch((function(e){console.log("Отправил лайк на сервер, но что-то не так: ",e)}))},l=function(e){var t="https://nomoreparties.co/v1/".concat(o.$I,"/cards/likes/").concat(e);return(0,a.SJ)(t).then((function(e){return console.log("Лайк удалён",e),(0,c.m)(c.$.dislikeMessage),e})).catch((function(t){console.log("Ошибка при снятии лайка",t,e)}))};function f(e){var t=e.target,n=t.dataset.parentCardId,r=document.querySelector('[data-card-id="'.concat(n,'"]')),o=t.classList.contains("card__like-button_is-active");(o?l:u)(n).then((function(e){t.classList.toggle("card__like-button_is-active"),(0,i.Xg)(r,e)})).catch((function(e){console.log("Ошибка при ".concat(o?"снятии":"постановке"," лайка"),e)}))}var d=function(e){var t=e.target.dataset.parentCardId,n=document.querySelector('[data-card-id="'.concat(t,'"]')),r=o.ZT+"/"+t;(0,a.SJ)(r).then((function(){n.remove(),(0,c.m)(c.$.deleteCardMessage)})).catch((function(e){console.log("Не удалось удалить карточку",e)}))};function v(e,t,n,r){var a=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),c=a.querySelector(".card__image"),s=a.querySelector(".card__title");if(a.querySelector(".card__likes"),c.src=e.link,c.alt=e.name,s.textContent=e.name,a.dataset.cardId=e._id,a.dataset.cardOwnerId=e.owner._id,(0,i.Xg)(a,e),a.dataset.cardOwnerId===o.m0._id){var u=a.querySelector(".card__delete-button");u.classList.add("card__delete-button-active"),u.dataset.parentCardId=a.dataset.cardId,u.addEventListener("click",r)}return c.addEventListener("click",(function(e){n(c)})),a.querySelector(".card__like-button").addEventListener("click",t),a}document.querySelector(".content").querySelector(".places__list");var p=function(e,t){var n={likes:[],createdAt:"",name:e,link:t,_id:"",owner:o.m0};return(0,a.LO)(n,o._8).then((function(e){var t=v(e,f,o.NL,d);return t.dataset.cardId=e._id,t.querySelector(".card__like-button").dataset.parentCardId=t.dataset.cardId,t.querySelector(".card__delete-button").dataset.parentCardId=t.dataset.cardId,t})).catch((function(e){return console.log("Не удалось выложить карточку:",e),Promise.reject("Что-то пошло не так: ".concat(e))}))};r()}catch(m){r(m)}}))},947:(e,t,n)=>{function r(e){e.currentTarget===e.target&&a(document.querySelector(".popup_is-opened"))}function o(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function a(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keyup",o),e.removeEventListener("click",r)}function c(e){e.classList.add("popup_is-opened"),window.addEventListener("keyup",o),e.addEventListener("click",r)}n.d(t,{O:()=>a,q:()=>c})},734:(e,t,n)=>{n.d(t,{$:()=>a,m:()=>o});var r=n(614),o=function(e){var t=document.querySelector(".server-notification"),n=t.querySelector(".notification-title"),o=t.querySelector(".notification-message");n.textContent=e.title,o.textContent=e.text,(0,r.LF)(t,"notification"),setTimeout((function(){(0,r.LF)(t,"notification")}),2e3)},a={likeMessage:{title:"Поймали ваш лайк!",text:"Он уже улетел на сервер"},dislikeMessage:{title:"Сняли ваш лайк!",text:"Иногда то, что раньше любил, может и разонравиться"},newCardMessage:{title:"Добавили новую карточку!",text:"Ну уж эта точно соберёт много лайков"},newCardMessageErr:{title:"Новую карточку загрузить не удалось!",text:"Обновите страницу и попробуйте ещё раз"},deleteCardMessage:{title:"Карточка удалена!",text:"Что делать с вашими карточками, решать только вам"},profileInfoUpdated:{title:"Инорфмация обновлена!",text:"Её уже видят другие участники проекта"},profileInfoUpdatedErr:{title:"Что-то пошло не так!",text:"Информацию обновить не удалось"},profileAvatarUpdated:{title:"Аватарка обновлена!",text:"Её уже видят другие участники проекта"},profileAvatarUpdatedErr:{title:"Что-то пошло не так!",text:"Аватарку обновить не удалось"}}},756:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{Xg:()=>p,g8:()=>d,kC:()=>l});var o=n(497),a=n(795),c=n(36),i=n(694),s=n(614),u=e([o,a,i]);[o,a,i]=u.then?(await u)():u;var l=function(){return(0,a.fG)(o.dx).then((function(e){o.Qn.textContent=e.name,o.mo.textContent=e.about,o.ZH.style.backgroundImage=(0,c.a)(e.avatar),o.JE.value=e.avatar,o.hz.value=e.name,o.Bl.value=e.about,console.log("Профиль, отрисован",e)})).catch((function(e){console.log("Не удалось отрисовать профиль",e)}))},d=function(){(0,a.fG)(o.ZT).then((function(e){e.sort((function(e,t){var n=e.likes.length,r=t.likes.length;return n>r?-1:n<r?1:0})).forEach((function(e){var t=(0,i.zY)(e,i.G1,o.NL,i.GO);o.dm.append(t)}))}))},p=function(e,t){var n=e.querySelector(".card__like-button"),r=e.querySelector(".card__likes");n.dataset.parentCardId=e.dataset.cardId,t.likes.length>0?((0,s.ZZ)(r,t.likes.length),setTimeout((function(){r.classList.remove("card__likes-hidden")}),300)):((0,s.ZZ)(r,t.likes.length),r.classList.add("card__likes-hidden"));var a=t.likes.some((function(e){return e._id==o.m0._id}));n.classList.toggle("card__like-button_is-active",a)};r()}catch(e){r(e)}}))},614:(e,t,n)=>{n.d(t,{LF:()=>o,ZZ:()=>r,bY:()=>a});var r=function(e,t){e.classList.add("text-visually-hidden"),e.classList.remove("text-visible"),setTimeout((function(n){e.textContent=t,e.classList.remove("text-visually-hidden"),e.classList.add("text-visible")}),300)},o=function(e,t){var n=t+"-hidden",r=t+"-visually-hidden";e.classList.contains(n)?(e.classList.remove(n),setTimeout((function(){e.classList.remove(r)}),20)):(e.classList.add(r),e.addEventListener("transitionend",(function(t){e.classList.add(n)}),{capture:!1,once:!0,passive:!1}))};function a(e,t){t.textContent=e?"Сохранение...":"Сохранить",t.disabled=e}},878:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{R:()=>i,X:()=>s});var o=n(795),a=n(497),c=e([o,a]);[o,a]=c.then?(await c)():c;var i=function(e,t){var n={name:e,about:t};return(0,o.D9)(n,a.dx)},s=function(e){var t={avatar:e};return(0,o.D9)(t,a.mI)};r()}catch(e){r(e)}}))},36:(e,t,n)=>{n.d(t,{U:()=>o,a:()=>r});var r=function(e){return"url("+e+")"},o=function(e){return e.substring(5,e.length-2)}},547:(e,t,n)=>{n.d(t,{F:()=>c,R:()=>i});var r=n(614),o=function(e,t,n){t.classList.remove(n);var o=e.querySelector(".".concat(t.id,"-error"));(0,r.ZZ)(o,"")},a=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)},c=function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);a(n,c,t),n.forEach((function(i){i.addEventListener("input",(function(){(function(e,t,n){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.patternMismatchErrorMessage):e.setCustomValidity("")}(t),t.validity.valid?o(e,t,n.errorClass):function(e,t,n,o){t.classList.add(o);var a=e.querySelector(".".concat(t.id,"-error"));a.classList.remove("popup__input_transparent_text"),(0,r.ZZ)(a,n)}(e,t,t.validationMessage,n.errorClass)})(e,i,t),a(n,c,t)}))}))}(t,e)}))};function i(e,t,n){var r=e.querySelector(n.formSelector),c=Array.from(r.querySelectorAll(n.inputSelector));c.forEach((function(e){o(r,e,n.errorClass)})),a(c,t,n)}},497:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{$I:()=>v,Bl:()=>O,JE:()=>N,NL:()=>F,Qn:()=>q,ZH:()=>Y,ZT:()=>h,_8:()=>S,dm:()=>g,dx:()=>m,hz:()=>I,m0:()=>_,mI:()=>y,mo:()=>L});var o=n(947),a=n(694),c=n(36),i=n(547),s=n(756),u=n(878),l=n(795),d=n(734),p=n(614),f=e([a,s,u,l]);[a,s,u,l]=f.then?(await f)():f;var v="wff-cohort-21",m="https://nomoreparties.co/v1/".concat(v,"/users/me"),_=await(0,l.fG)(m),y="https://nomoreparties.co/v1/".concat(v,"/users/me/avatar"),h="https://nomoreparties.co/v1/".concat(v,"/cards"),S="https://nomoreparties.co/v1/".concat(v,"/cards"),b=document.querySelector(".content"),g=b.querySelector(".places__list"),k=b.querySelector(".profile__info"),q=k.querySelector(".profile__title"),L=k.querySelector(".profile__description"),E=b.querySelector(".profile__edit-button"),x=document.querySelector(".popup_type_edit"),C=x.querySelector(".popup__close"),w=document.forms["edit-profile"],I=w.elements.profile__title,O=w.elements.profile__description,Z=w.querySelector("button");E.addEventListener("click",(function(e){(0,i.R)(x,Z,z),I.value=q.textContent,O.value=L.textContent,(0,o.q)(x)})),w.addEventListener("submit",(function(e){e.preventDefault(),q.textContent==I.value&&L.textContent==O.value?(0,o.O)(x):((0,p.bY)(!0,Z),(0,u.R)(I.value,O.value).then((function(e){(0,p.ZZ)(q,e.name),(0,p.ZZ)(L,e.about),(0,d.m)(d.$.profileInfoUpdated)})).catch((function(e){console.log("Ошибка при обновлении информации в профиле:",e),(0,d.m)(d.$.profileInfoUpdatedErr)})).finally((function(){(0,p.bY)(!1,Z),(0,i.R)(x,Z,z),(0,o.O)(x)})))})),C.addEventListener("click",(function(e){(0,o.O)(x)}));var U=b.querySelector(".profile__add-button"),M=document.querySelector(".popup_type_new-card"),T=M.querySelector(".popup__close"),$=document.forms["new-place"],A=$.querySelector(".button"),R=$.elements["place-name"],P=$.elements.link;R.value="Случайная картинка",P.value="https://random.imagecdn.app/300/300",U.addEventListener("click",(function(e){(0,i.R)(M,A,z),(0,o.q)(M)})),T.addEventListener("click",(function(e){(0,i.R)(M,A,z),(0,o.O)(M)})),$.addEventListener("submit",(function(e){e.preventDefault(),(0,p.bY)(!0,A),(0,a.dW)(R.value,P.value).then((function(e){g.prepend(e),(0,d.m)(d.$.newCardMessage)})).catch((function(e){console.log("Ошибка при обновлении информации в профиле:",e),(0,d.m)(d.$.newCardMessageErr)})).finally((function(){(0,p.bY)(!1,A),(0,o.O)(M),(0,i.R)(M,A,z),$.reset()}))}));var G=document.querySelector(".popup_type_image");function F(e){var t=G.querySelector(".popup__image"),n=G.querySelector(".popup__caption");t.src=e.src,t.alt=e.alt,n.textContent=e.alt,(0,o.q)(G)}G.querySelector(".popup__close").addEventListener("click",(function(e){(0,o.O)(G)}));var Y=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_profile-image-edit"),D=j.querySelector(".popup__close"),J=document.forms["edit-profile-image"],B=J.querySelector(".button"),N=J.elements["link-to-image"];Y.addEventListener("click",(function(e){(0,i.R)(j,B,z),(0,o.q)(j),N.value=(0,c.U)(Y.style.backgroundImage)})),D.addEventListener("click",(function(e){(0,o.O)(j),(0,i.R)(j,B,z)})),J.addEventListener("submit",(function(e){e.preventDefault(),(0,c.U)(Y.style.backgroundImage)==N.value?(0,o.O)(j):((0,p.bY)(!0,B),(0,u.X)(N.value).then((function(e){Y.style.backgroundImage=(0,c.a)(e.avatar),(0,d.m)(d.$.profileAvatarUpdated)})).catch((function(e){console.log("Ошибка при обновлении аватарки:",e),(0,d.m)(d.$.profileAvatarUpdatedErr)})).finally((function(){(0,p.bY)(!1,B),(0,i.R)(j,B,z),(0,o.O)(j)})))}));var z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};(0,i.F)(z),(0,s.kC)(),(0,s.g8)(),r()}catch(X){r(X)}}),1)}},a={};function c(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return o[e](n,n.exports,c),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},c.a=(o,a,c)=>{var i;c&&((i=[]).d=-1);var s,u,l,d=new Set,p=o.exports,f=new Promise(((e,t)=>{l=t,u=e}));f[t]=p,f[e]=e=>(i&&e(i),d.forEach(e),f.catch((e=>{}))),o.exports=f,a((o=>{var a;s=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var a=[];a.d=0,o.then((e=>{c[t]=e,r(a)}),(e=>{c[n]=e,r(a)}));var c={};return c[e]=e=>e(a),c}}var i={};return i[e]=e=>{},i[t]=o,i})))(o);var c=()=>s.map((e=>{if(e[n])throw e[n];return e[t]})),u=new Promise((t=>{(a=()=>t(c)).r=0;var n=e=>e!==i&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));s.map((t=>t[e](n)))}));return a.r?u:c()}),(e=>(e?l(f[n]=e):u(p),r(i)))),i&&i.d<0&&(i.d=0)},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c(497)})();