(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{I3:()=>$,Bl:()=>N,gJ:()=>E,Wr:()=>L,JU:()=>k,NL:()=>Q,ZT:()=>b,JE:()=>Y,I8:()=>h,dm:()=>x,mI:()=>q,dx:()=>S,mo:()=>P,ZH:()=>U,Qn:()=>T,hz:()=>B});var t=function(e,t){t.classList.remove($.errorClass);var n=e.querySelector(".".concat(t.id,"-error"));n.classList.add("popup__input_transparent_text"),n.textContent=""},n=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove($.inactiveButtonClass):t.classList.add($.inactiveButtonClass)},o=function(){Array.from(document.querySelectorAll($.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var o=Array.from(e.querySelectorAll($.inputSelector)),r=e.querySelector($.submitButtonSelector);n(o,r),o.forEach((function(c){c.addEventListener("input",(function(){(function(e,n){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.patternMismatchErrorMessage):e.setCustomValidity("")}(n),n.validity.valid?t(e,n):function(e,t,n){t.classList.add($.errorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove("popup__input_transparent_text"),o.textContent=n}(e,n,n.validationMessage)})(e,c),n(o,r)}))}))}(e)}))};function r(e){e.currentTarget===e.target&&a(document.querySelector(".popup_is-opened"))}function c(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function a(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keyup",c),e.removeEventListener("click",r),null!=e.querySelector(".popup__form")&&function(e){var n=e.querySelector($.formSelector);Array.from(n.querySelectorAll($.inputSelector)).forEach((function(e){t(n,e)}))}(e)}function i(e){e.classList.add("popup_is-opened"),window.addEventListener("keyup",c),e.addEventListener("click",r)}var u="936197d7-9c28-4a02-b461-a2e30a81b6a7",l=function(e){return fetch(e,{headers:{authorization:u}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log("Ошибка в запросе GET: ".concat(e,".\nПопробуйте перезагрузить страницу.")),L.classList.add("server-error-visible"),L.textContent="Ошибка в запросе GET: ".concat(e,".\nПопробуйте перезагрузить страницу.")}))},s=function(e,t){fetch(t,{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(n){return n.ok?(console.log("PATCH, успешно",e,t,n),n.json()):Promise.reject("Что-то пошло не так: ".concat(n.status))})).catch((function(n){return console.log("Ошибка в запросе PATCH:",n,e,t),L.classList.add("server-error-visible"),k.textContent=n,E.textContent="Ошибка. Попробуйте перезагрузить страницу",Promise.reject("Что-то пошло не так: ".concat(n))}))},d=function(e){var t=document.querySelector('[data-card-id="'.concat(e,'"]'));fetch(b+"/"+e,{method:"DELETE",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(n){return n.ok?(console.log("Удалено",e,t,n),n.json()):Promise.reject("Что-то пошло не так: ".concat(n.status))})).catch((function(n){return console.log("Ошибка при удалении карточки: ",n,e,t),Promise.reject("Что-то пошло не так: ".concat(n))})),t.remove()};function p(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var f=function(e){return"url("+e+")"},m=function(e){return e.substring(5,e.length-2)};function v(e){e.target.classList.toggle("card__like-button_is-active")}function _(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__image"),c=o.querySelector(".card__title"),a=o.querySelector(".card__likes");return r.src=e.link,r.alt=e.name,c.textContent=e.name,o.dataset.cardId=e._id,o.dataset.cardOwnerId=e.owner._id,e.likes.length>0?a.textContent=e.likes.length:a.classList.add("no-likes"),o.dataset.cardOwnerId===h&&function(e){var t=e.querySelector(".card__delete-button");t.classList.add("card__delete-button-active"),t.dataset.parentCardId=e.dataset.cardId,t.addEventListener("click",(function(e){d(t.dataset.parentCardId)}))}(o),r.addEventListener("click",(function(e){n(r)})),o.querySelector(".card__like-button").addEventListener("click",t),o}document.querySelector(".content").querySelector(".places__list");var y="wff-cohort-21",S="https://nomoreparties.co/v1/".concat(y,"/users/me"),h="b0a677a5e8188a38bb4f5ba8",q="https://nomoreparties.co/v1/".concat(y,"/users/me/avatar"),b="https://nomoreparties.co/v1/".concat(y,"/cards"),g="https://nomoreparties.co/v1/".concat(y,"/cards"),C=document.querySelector(".content"),L=document.querySelector(".server-error"),k=L.querySelector(".error-title"),E=L.querySelector(".error-message"),x=C.querySelector(".places__list"),j=C.querySelector(".profile__info"),T=j.querySelector(".profile__title"),P=j.querySelector(".profile__description"),I=C.querySelector(".profile__edit-button"),w=document.querySelector(".popup_type_edit"),O=w.querySelector(".popup__close"),A=document.forms["edit-profile"],B=A.elements.profile__title,N=A.elements.profile__description,z=A.querySelector("button");I.addEventListener("click",(function(e){i(w),B.value=T.textContent,N.value=P.textContent})),A.addEventListener("submit",(function(e){e.preventDefault(),p(!0,z),T.textContent=B.value,P.textContent=N.value,setTimeout((function(){!function(e,t){s({name:e,about:t},S)}(B.value,N.value),a(w),p(!1,z)}),300)})),O.addEventListener("click",(function(e){a(w)}));var D=C.querySelector(".profile__add-button"),H=document.querySelector(".popup_type_new-card"),J=H.querySelector(".popup__close"),M=document.forms["new-place"],G=M.querySelector(".button"),V=M.elements["place-name"],W=M.elements.link;V.value="new card",W.value="https://i.postimg.cc/j5NsqWyG/temp-Image-NGHu-Mi.avif",D.addEventListener("click",(function(e){i(H)})),J.addEventListener("click",(function(e){a(H)})),M.addEventListener("submit",(function(e){e.preventDefault(),p(!0,G);var t,n,o={name:V.value,link:W.value,_id:"",owner:{_id:h,about:P.textContent,avatar:m(U.style.backgroundImage),cohort:y,name:T.textContent}},r=_(o,v,Q);t=o,n=g,fetch(n,{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.ok?(console.log("POST",t,n," — успешно"),e.json()):Promise.reject("Что-то пошло не так: ".concat(e.status))})).catch((function(e){return console.log("Ошибка в запросе POST",t,n,e),Promise.reject("Что-то пошло не так: ".concat(e))})),setTimeout((function(){p(!1,G),a(H),M.reset(),x.prepend(r)}),300)}));var Z=document.querySelector(".popup_type_image");function Q(e){var t=Z.querySelector(".popup__image"),n=Z.querySelector(".popup__caption");t.src=e.src,t.alt=e.alt,n.textContent=e.alt,i(Z)}Z.querySelector(".popup__close").addEventListener("click",(function(e){a(Z)}));var U=document.querySelector(".profile__image"),F=document.querySelector(".popup_type_profile-image-edit"),K=F.querySelector(".popup__close"),R=document.forms["edit-profile-image"],X=R.querySelector(".button"),Y=R.elements["link-to-image"];U.addEventListener("click",(function(e){i(F),Y.value=m(U.style.backgroundImage)})),K.addEventListener("click",(function(e){a(F)})),R.addEventListener("submit",(function(e){e.preventDefault(),p(!0,X),setTimeout((function(){var e;p(!1,X),U.style.backgroundImage=f(Y.value),e=Y.value,s({avatar:e},q),a(F)}),300)}));var $={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};o(),l(S).then((function(e){T.textContent=e.name,P.textContent=e.about,U.style.backgroundImage=f(e.avatar),Y.value=e.avatar,B.value=e.name,N.value=e.about})).catch((function(e){console.log(e)})).then(o),l(b).then((function(e){e.forEach((function(e){var t=_(e,v,d);x.append(t)}))}))})();