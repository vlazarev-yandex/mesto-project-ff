(()=>{"use strict";var e,t,r,n,a={378:(e,t,r)=>{r.d(t,{$W:()=>n,D9:()=>i,LO:()=>s,SJ:()=>u,Uc:()=>l,fG:()=>c});var n={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-21"),headers:{authorization:"936197d7-9c28-4a02-b461-a2e30a81b6a7","Content-Type":"application/json"}},a=function(e){return e.ok?(console.log("Успешно",e),e.json()):Promise.reject(e.status)},o=function(e){return Promise.reject("Что-то пошло не так: ".concat(e))},c=function(e){return fetch(e,{headers:n.headers}).then(a).catch(o)},i=function(e,t){return fetch(t,{method:"PATCH",headers:n.headers,body:JSON.stringify(e)}).then(a).catch(o)},u=function(e){return fetch(e,{method:"DELETE",headers:n.headers}).then(a).catch(o)},s=function(e,t){return fetch(t,{method:"POST",headers:n.headers,body:JSON.stringify(e)}).then(a).catch(o)},l=function(e,t){return fetch(t,{method:"PUT",headers:n.headers,body:JSON.stringify(e)}).then(a).catch(o)}},186:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.d(t,{g:()=>l});var a=r(497),o=r(378),c=r(617),i=r(662),u=r(425),s=e([a,c,i]);[a,c,i]=s.then?(await s)():s;var l=function(){var e,t=document.querySelector(".places__list");return(e=o.$W.baseUrl+"/cards",(0,o.fG)(e).then((function(e){return e})).catch((function(e){return Promise.reject("Не удалось получить карточки".concat(e))}))).then((function(e){e.sort((function(e,t){var r=e.likes.length,n=t.likes.length;return r>n?-1:r<n?1:0})).forEach((function(r){var n=(0,i.z)(r,c.G,a.NL,u.G,a.m0);return t.append(n),e}))})).catch((function(e){return Promise.reject("Не удалось отрисовать профиль: ".concat(e))}))};n()}catch(e){n(e)}}))},128:(e,t,r)=>{r.d(t,{k:()=>c});var n=r(378),a=r(36);function o(e,t){e?t.classList.add("profile__image_loader"):t.classList.remove("profile__image_loader")}var c=function(){var e,t=document.querySelector(".profile__info"),r=t.querySelector(".profile__title"),c=t.querySelector(".profile__description"),i=document.querySelector(".profile__image");return o(!0,i),(e=n.$W.baseUrl+"/users/me",(0,n.fG)(e).then((function(e){return e})).catch((function(e){return Promise.reject("Не удалось получить профиль".concat(e))}))).then((function(e){return r.textContent=e.name,c.textContent=e.about,i.style.backgroundImage=(0,a.a)(e.avatar),e})).catch((function(e){return Promise.reject("Не удалось отрисовать профиль: ".concat(e))})).finally((function(){o(!1,i)}))}},635:(e,t,r)=>{r.d(t,{R:()=>a,X:()=>o});var n=r(378),a=function(e,t){var r=n.$W.baseUrl+"/users/me",a={name:e,about:t};return(0,n.D9)(a,r)},o=function(e){var t=n.$W.baseUrl+"/users/me/avatar",r={avatar:e};return(0,n.D9)(r,t)}},662:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.d(t,{d:()=>s,z:()=>l});var a=r(497),o=r(378),c=r(617),i=r(425),u=e([a,c]);function l(e,t,r,n,a){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),i=o.querySelector(".card__image"),u=o.querySelector(".card__title");if(i.src=e.link,i.alt=e.name,u.textContent=e.name,o.dataset.cardId=e._id,o.dataset.cardOwnerId=e.owner._id,(0,c.X)(o,e),o.dataset.cardOwnerId===a._id){var s=o.querySelector(".card__delete-button");s.classList.add("card__delete-button-active"),s.dataset.parentCardId=o.dataset.cardId,s.addEventListener("click",n)}return i.addEventListener("click",(function(e){r(i)})),o.querySelector(".card__like-button").addEventListener("click",t),o}[a,c]=u.then?(await u)():u,document.querySelector(".content").querySelector(".places__list");var s=function(e,t,r){var n=o.$W.baseUrl+"/cards",u={likes:[],createdAt:"",name:e,link:t,_id:"",owner:r};return(0,o.LO)(u,n).then((function(e){var t=l(e,c.G,a.NL,i.G,r);return t.dataset.cardId=e._id,t.querySelector(".card__like-button").dataset.parentCardId=t.dataset.cardId,t.querySelector(".card__delete-button").dataset.parentCardId=t.dataset.cardId,t})).catch((function(e){return console.log("Не удалось выложить карточку:",e),Promise.reject("Что-то пошло не так: ".concat(e))}))};n()}catch(d){n(d)}}))},425:(e,t,r)=>{r.d(t,{G:()=>o});var n=r(378),a=r(734),o=function(e){var t=e.target.dataset.parentCardId,r=document.querySelector('[data-card-id="'.concat(t,'"]'));return function(e){var t=n.$W.baseUrl+"/cards/"+e;return(0,n.SJ)(t).then((function(e){return e})).catch((function(e){return Promise.reject("Ошибка при удалении карточки с сервера: ".concat(e))}))}(t).then((function(e){return r.remove(),(0,a.m)(a.$.deleteCardMessage),e})).catch((function(e){return Promise.reject("Ошибка при удалении карточки с сервера: ".concat(e))}))}},617:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.d(t,{G:()=>f,X:()=>d});var a=r(497),o=r(734),c=r(378),i=r(614),u=e([a]);a=(u.then?(await u)():u)[0];var s=function(e){var t=c.$W.baseUrl+"/cards/likes/".concat(e);return(0,c.Uc)(a.m0,t).then((function(e){return console.log("Отправил лайк на сервер успешно",e),(0,o.m)(o.$.likeMessage),e})).catch((function(e){console.log("Отправил лайк на сервер, но что-то не так: ",e)}))},l=function(e){var t=c.$W.baseUrl+"/cards/likes/".concat(e);return(0,c.SJ)(t).then((function(e){return console.log("Лайк удалён",e),(0,o.m)(o.$.dislikeMessage),e})).catch((function(t){console.log("Ошибка при снятии лайка",t,e)}))};function f(e){var t=e.target,r=t.dataset.parentCardId,n=document.querySelector('[data-card-id="'.concat(r,'"]')),a=t.classList.contains("card__like-button_is-active");(a?l:s)(r).then((function(e){t.classList.toggle("card__like-button_is-active"),d(n,e)})).catch((function(e){console.log("Ошибка при ".concat(a?"снятии":"постановке"," лайка"),e)}))}var d=function(e,t){var r=e.querySelector(".card__like-button"),n=e.querySelector(".card__likes");r.dataset.parentCardId=e.dataset.cardId,t.likes.length>0?((0,i.ZZ)(n,t.likes.length),setTimeout((function(){n.classList.remove("card__likes-hidden")}),300)):((0,i.ZZ)(n,t.likes.length),n.classList.add("card__likes-hidden"));var o=t.likes.some((function(e){return e._id==a.m0._id}));r.classList.toggle("card__like-button_is-active",o)};n()}catch(p){n(p)}}))},957:(e,t,r)=>{function n(e){e.currentTarget===e.target&&o(document.querySelector(".popup_is-opened"))}function a(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function o(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keyup",a),e.removeEventListener("click",n)}function c(e){e.classList.add("popup_is-opened"),window.addEventListener("keyup",a),e.addEventListener("click",n)}r.d(t,{O:()=>o,q:()=>c})},734:(e,t,r)=>{r.d(t,{$:()=>o,m:()=>a});var n=r(614),a=function(e){var t=document.querySelector(".server-notification"),r=t.querySelector(".notification-title"),a=t.querySelector(".notification-message");r.textContent=e.title,a.textContent=e.text,(0,n.LF)(t,"notification"),setTimeout((function(){(0,n.LF)(t,"notification")}),2e3)},o={likeMessage:{title:"Поймали ваш лайк!",text:"Он уже улетел на сервер"},dislikeMessage:{title:"Сняли ваш лайк!",text:"Иногда то, что раньше любил, может и разонравиться"},newCardMessage:{title:"Добавили новую карточку!",text:"Ну уж эта точно соберёт много лайков"},newCardMessageErr:{title:"Новую карточку загрузить не удалось!",text:"Обновите страницу и попробуйте ещё раз"},deleteCardMessage:{title:"Карточка удалена!",text:"Что делать с вашими карточками, решать только вам"},profileInfoUpdated:{title:"Инорфмация обновлена!",text:"Её уже видят другие участники проекта"},profileInfoUpdatedErr:{title:"Что-то пошло не так!",text:"Информацию обновить не удалось"},profileAvatarUpdated:{title:"Аватарка обновлена!",text:"Её уже видят другие участники проекта"},profileAvatarUpdatedErr:{title:"Что-то пошло не так!",text:"Аватарку обновить не удалось"}}},614:(e,t,r)=>{r.d(t,{LF:()=>a,ZZ:()=>n,bY:()=>o});var n=function(e,t){e.classList.add("text-visually-hidden"),e.classList.remove("text-visible"),setTimeout((function(r){e.textContent=t,e.classList.remove("text-visually-hidden"),e.classList.add("text-visible")}),300)},a=function(e,t){var r=t+"-hidden",n=t+"-visually-hidden";e.classList.contains(r)?(e.classList.remove(r),setTimeout((function(){e.classList.remove(n)}),20)):(e.classList.add(n),e.addEventListener("transitionend",(function(t){e.classList.add(r)}),{capture:!1,once:!0,passive:!1}))};function o(e,t){t.textContent=e?"Сохранение...":"Сохранить",t.disabled=e}},36:(e,t,r)=>{r.d(t,{U:()=>a,a:()=>n});var n=function(e){return"url("+e+")"},a=function(e){return e.substring(5,e.length-2)}},547:(e,t,r)=>{r.d(t,{F:()=>c,R:()=>i});var n=r(614),a=function(e,t,r){t.classList.remove(r);var a=e.querySelector(".".concat(t.id,"-error"));(0,n.ZZ)(a,"")},o=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)},c=function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o(r,c,t),r.forEach((function(i){i.addEventListener("input",(function(){(function(e,t,r){!function(e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.patternMismatchErrorMessage):e.setCustomValidity("")}(t),t.validity.valid?a(e,t,r.errorClass):function(e,t,r,a){t.classList.add(a);var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove("popup__input_transparent_text"),(0,n.ZZ)(o,r)}(e,t,t.validationMessage,r.errorClass)})(e,i,t),o(r,c,t)}))}))}(t,e)}))};function i(e,t,r){var n=e.querySelector(r.formSelector),c=Array.from(n.querySelectorAll(r.inputSelector));c.forEach((function(e){a(n,e,r.errorClass)})),o(c,t,r)}},497:(e,t,r)=>{r.a(e,(async(e,n)=>{try{r.d(t,{NL:()=>D,m0:()=>v});var a=r(957),o=r(662),c=r(36),i=r(547),u=r(186),s=r(128),l=r(635),d=r(734),f=r(614),p=e([o,u]);[o,u]=p.then?(await p)():p;var v=await(0,s.k)(),m=(await(0,u.g)(),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});(0,i.F)(m);var _=document.querySelector(".content"),y=_.querySelector(".places__list"),h=document.querySelector(".profile__info"),b=h.querySelector(".profile__title"),S=h.querySelector(".profile__description"),g=document.querySelector(".profile__image"),q=_.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),L=k.querySelector(".popup__close"),E=document.forms["edit-profile"],C=E.elements.profile__title,x=E.elements.profile__description,w=E.querySelector("button");C.value=v.name,x.value=v.about,q.addEventListener("click",(function(e){(0,i.R)(k,w,m),C.value=b.textContent,x.value=S.textContent,(0,a.q)(k)})),E.addEventListener("submit",(function(e){e.preventDefault(),b.textContent==C.value&&S.textContent==x.value?(0,a.O)(k):((0,f.bY)(!0,w),(0,l.R)(C.value,x.value).then((function(e){(0,f.ZZ)(b,e.name),(0,f.ZZ)(S,e.about),(0,d.m)(d.$.profileInfoUpdated)})).catch((function(e){console.log("Ошибка при обновлении информации в профиле:",e),(0,d.m)(d.$.profileInfoUpdatedErr)})).finally((function(){(0,f.bY)(!1,w),(0,i.R)(k,w,m),(0,a.O)(k)})))})),L.addEventListener("click",(function(e){(0,a.O)(k)}));var U=document.querySelector(".popup_type_profile-image-edit"),I=U.querySelector(".popup__close"),O=document.forms["edit-profile-image"],$=O.querySelector(".button"),P=O.elements["link-to-image"];P.value=v.avatar,g.addEventListener("click",(function(e){(0,i.R)(U,$,m),(0,a.q)(U),P.value=(0,c.U)(g.style.backgroundImage)})),I.addEventListener("click",(function(e){(0,a.O)(U),(0,i.R)(U,$,m)})),O.addEventListener("submit",(function(e){e.preventDefault(),(0,c.U)(g.style.backgroundImage)==P.value?(0,a.O)(U):((0,f.bY)(!0,$),(0,l.X)(P.value).then((function(e){g.style.backgroundImage=(0,c.a)(e.avatar),(0,d.m)(d.$.profileAvatarUpdated)})).catch((function(e){console.log("Ошибка при обновлении аватарки:",e),(0,d.m)(d.$.profileAvatarUpdatedErr)})).finally((function(){(0,f.bY)(!1,$),(0,i.R)(U,$,m),(0,a.O)(U)})))}));var j=_.querySelector(".profile__add-button"),M=document.querySelector(".popup_type_new-card"),Z=M.querySelector(".popup__close"),A=document.forms["new-place"],R=A.querySelector(".button"),T=A.elements["place-name"],G=A.elements.link;T.value="Случайная картинка",G.value="https://random.imagecdn.app/300/300",j.addEventListener("click",(function(e){(0,i.R)(M,R,m),(0,a.q)(M)})),Z.addEventListener("click",(function(e){(0,i.R)(M,R,m),(0,a.O)(M)})),A.addEventListener("submit",(function(e){e.preventDefault(),(0,f.bY)(!0,R),(0,o.d)(T.value,G.value,v).then((function(e){y.prepend(e),(0,d.m)(d.$.newCardMessage)})).catch((function(e){console.log("Ошибка при обновлении информации в профиле:",e),(0,d.m)(d.$.newCardMessageErr)})).finally((function(){(0,f.bY)(!1,R),(0,a.O)(M),(0,i.R)(M,R,m),A.reset()}))}));var W=document.querySelector(".popup_type_image");function D(e){var t=W.querySelector(".popup__image"),r=W.querySelector(".popup__caption");t.src=e.src,t.alt=e.alt,r.textContent=e.alt,(0,a.q)(W)}W.querySelector(".popup__close").addEventListener("click",(function(e){(0,a.O)(W)})),n()}catch(N){n(N)}}),1)}},o={};function c(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return a[e](r,r.exports,c),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},c.a=(a,o,c)=>{var i;c&&((i=[]).d=-1);var u,s,l,d=new Set,f=a.exports,p=new Promise(((e,t)=>{l=t,s=e}));p[t]=f,p[e]=e=>(i&&e(i),d.forEach(e),p.catch((e=>{}))),a.exports=p,o((a=>{var o;u=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var o=[];o.d=0,a.then((e=>{c[t]=e,n(o)}),(e=>{c[r]=e,n(o)}));var c={};return c[e]=e=>e(o),c}}var i={};return i[e]=e=>{},i[t]=a,i})))(a);var c=()=>u.map((e=>{if(e[r])throw e[r];return e[t]})),s=new Promise((t=>{(o=()=>t(c)).r=0;var r=e=>e!==i&&!d.has(e)&&(d.add(e),e&&!e.d&&(o.r++,e.push(o)));u.map((t=>t[e](r)))}));return o.r?s:c()}),(e=>(e?l(p[r]=e):s(f),n(i)))),i&&i.d<0&&(i.d=0)},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c(497)})();